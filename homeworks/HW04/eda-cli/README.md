# HW04 — HTTP-сервис качества датасетов (FastAPI + eda-cli)

Проект является решением домашнего задания **HW04** семинара **S04** курса «Инженерия искусственного интеллекта».

В рамках HW04 на основе проекта **eda-cli** (HW03) реализован **HTTP-сервис** для оценки качества датасетов с использованием **FastAPI**.

---

## 1. Назначение проекта

Сервис предоставляет REST API для:

- проверки доступности сервиса (`/health`);
- эвристической оценки качества датасета по агрегированным признакам (`/quality`);
- оценки качества датасета на основе CSV-файла (`/quality-from-csv`);
- предоставления EDA-результатов и эвристик качества из HW03 через HTTP;
- дополнительных вспомогательных операций над CSV-файлами (сводка, пропуски, head/sample).

Проект демонстрирует переход от **библиотеки + CLI** (HW03) к **HTTP-сервису**.

---

## 2. Структура проекта

```text
eda-cli/
├── pyproject.toml
├── README.md
├── src/
│   └── eda_cli/
│       ├── __init__.py
│       ├── core.py        # EDA-ядро и эвристики качества (HW03)
│       ├── viz.py
│       ├── cli.py
│       └── api.py         # HTTP API (HW04)
├── tests/
│   └── test_core.py
└── data/
    └── example.csv
````

---

## 3. Установка и запуск

Перейти в каталог проекта:

```bash
cd homeworks/HW04/eda-cli
```

Установить зависимости:

```bash
uv sync
```

Запустить HTTP-сервис:

```bash
uv run uvicorn eda_cli.api:app --reload --port 8000
```

Swagger UI будет доступен по адресу:

```
http://127.0.0.1:8000/docs
```

---

## 4. Реализованные эндпоинты

### Обязательные эндпоинты (HW04)

#### `GET /health`

Проверка доступности сервиса.

Ответ:

```json
{"status": "ok"}
```

---

#### `POST /quality`

Оценка качества датасета по агрегированным признакам.

Вход (JSON):

```json
{
  "n_rows": 100,
  "n_cols": 10,
  "missing_share": 0.1
}
```

Выход:

```json
{
  "ok_for_model": true,
  "quality_score": 1.0,
  "latency_ms": 2.3,
  "flags": {
    "too_few_rows": false,
    "too_many_missing": false
  }
}
```

---

#### `POST /quality-from-csv`

Оценка качества датасета на основе CSV-файла.

* принимает `multipart/form-data` с CSV;
* использует функции `summarize_dataset`, `missing_table`, `compute_quality_flags` из HW03;
* обрабатывает ошибки чтения и пустой CSV с возвратом **HTTP 400**.

---

### Дополнительные эндпоинты (используют логику HW03)

#### `POST /summary-from-csv`

HTTP-версия EDA-сводки из HW03.

Возвращает:

* форму датасета;
* результат `summarize_dataset`;
* таблицу пропусков;
* полный набор флагов качества.

---

#### `POST /quality-flags-from-csv`

Возвращает только булевы флаги качества датасета.

---

### Вспомогательные эндпоинты

* `POST /missing-table-from-csv` — таблица пропусков;
* `POST /head-from-csv?n=5` — первые строки датасета;
* `POST /sample-from-csv?n=5` — случайная выборка строк;
* `GET /metrics` — простая статистика по работе сервиса (в памяти).

---

## 5. Обработка ошибок

Для CSV-эндпоинтов реализована явная обработка ошибок:

* пустой файл;
* файл, состоящий только из пробелов/переводов строк;
* ошибки чтения CSV;
* CSV без строк или колонок.

Во всех этих случаях сервис возвращает:

```http
HTTP 400 Bad Request
```

Ошибки задекларированы в OpenAPI и видны в Swagger UI.

---

## 6. Проверка работоспособности

Пример проверки:

```bash
curl http://127.0.0.1:8000/health
```

```bash
curl -X POST http://127.0.0.1:8000/quality \
  -H "Content-Type: application/json" \
  -d "{\"n_rows\":100,\"n_cols\":10,\"missing_share\":0.1}"
```

```bash
curl -X POST http://127.0.0.1:8000/quality-from-csv \
  -F "file=@data/example.csv"
```

---

## 7. Соответствие требованиям HW04

* [x] Проект расположен в `homeworks/HW04/`
* [x] Используется FastAPI и uvicorn
* [x] Реализованы `/health`, `/quality`, `/quality-from-csv`
* [x] Реализован собственный эндпоинт, использующий доработки HW03
* [x] Реализована обработка ошибок CSV с HTTP 400
* [x] Сервис запускается стандартной командой `uv run uvicorn ...`

---

## 8. Контекст

Проект является учебным и предназначен для демонстрации архитектуры HTTP-сервиса поверх EDA-ядра.


